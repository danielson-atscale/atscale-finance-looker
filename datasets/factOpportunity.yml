unique_name: factOpportunity
object_type: dataset
label: factOpportunity
columns:
  - name: AccountID
    data_type: string
  - name: Amount
    data_type: decimal(38,9)
  - name: CloseDate
    data_type: date
  - name: CreatedBy
    data_type: string
  - name: CreatedDate
    data_type: datetime
  - name: Description
    data_type: string
  - name: ForecastCategory
    data_type: string
  - name: Id
    data_type: string
  - name: IsClosed
    data_type: boolean
  - name: IsDeleted
    data_type: boolean
  - name: IsWon
    data_type: boolean
  - name: AmountLastChanged
    data_type: datetime
  - name: CloseDateLastChanged
    data_type: datetime
  - name: StageLastChanged
    data_type: datetime
  - name: LeadSource
    data_type: string
  - name: Name
    data_type: string
  - name: NextStep
    data_type: string
  - name: OpportunityOwner
    data_type: string
  - name: OwnerId
    data_type: string
  - name: Probability
    data_type: double
  - name: RecordTypeId
    data_type: string
  - name: RecordType
    data_type: string
  - name: Stage
    data_type: string
  - name: Type
    data_type: string
  - name: SyncedQuoteId
    data_type: string
  - name: NetNewARR
    data_type: decimal(38,9)
  - name: ExpiringARR
    data_type: decimal(38,9)
  - name: OpportunityARR
    data_type: decimal(38,9)
  - name: CloudSpend
    data_type: decimal(38,9)
  - name: RenewalProbability
    data_type: double
  - name: SalesEngineerId
    data_type: string
  - name: SalesEngineer
    data_type: string
  - name: BDRId
    data_type: string
  - name: BDRName
    data_type: string
  - name: HighestLevelBusinessContactId
    data_type: string
  - name: HighestLevelBusinessContact
    data_type: string
  - name: POCStatus
    data_type: string
  - name: BITools
    data_type: string
  - name: Competition
    data_type: string
  - name: BusinessUseCase
    data_type: string
  - name: SuccessMetrics
    data_type: string
  - name: PositiveBusinessOutcomes
    data_type: string
  - name: PathtoClose
    data_type: string
  - name: TechnicalWin
    data_type: string
  - name: LostReason
    data_type: string
  - name: POCStartDate
    data_type: date
  - name: POCEndDate
    data_type: date
  - name: LostReason
    data_type: string
  - name: ExpectedRenewalARR
    data_type: decimal(38,9)
    sql: >-
       IF(IsClosed = False OR Stage = '6-Closed Lost', RenewalProbability*ExpiringARR, 
       IF(IsWon = True AND NetNewARR >=0, RenewalProbability*ExpiringARR, 
       IF(IsWon = True AND NetNewARR < 0, RenewalProbability*OpportunityARR, NULL)))  
  - name: POCStatus(Translated)
    data_type: string
    sql: >-
       IF(POCStatus = 'N/A - POC Not Needed', 'POC Not Needed',
       IF(RecordType = 'Renewal', 'POC Not Needed',
       IF(Stage <> '5-Closed Won' AND Stage <> '6-Closed Lost' AND POCStartDate IS NULL, 'Pre-POC', 
       IF(Stage = '6-Closed Lost' AND POCStartDate IS NULL, 'No POC',
       IF(Stage <> '5-Closed Won' AND Stage <> '6-Closed Lost' AND POCStartDate IS NOT NULL AND POCEndDate IS NULL, 'POC In Progress',
       IF(Stage <> '5-Closed Won' AND Stage <> '6-Closed Lost' AND POCStartDate IS NOT NULL AND POCEndDate IS NOT NULL, 'POC Complete',
       IF(Stage = '5-Closed Won' AND POCStartDate IS NOT NULL AND POCEndDate IS NOT NULL, 'Won POC',
       IF(Stage = '6-Closed Lost' AND POCStartDate IS NOT NULL, 'Lost POC', 'No POC'))))))))
  - name: MaxDate
    data_type: string
    sql: >-
      MAX([dimOpportunityNextStep].[CreatedDate])
  - name: ReachedPOCYesorNo
    data_type: decimal
    sql: >-
      IF(POCStartDate IS NULL, 0, 1)
connection_id: con_atscale-data-warehouse_AIA_dbt
table: FactOpportunity
